<!DOCTYPE html>












  



<script type="text/javascript" src="//cdn.bootcss.com/canvas-nest.js/1.0.0/canvas-nest.min.js"></script>


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2"/>
<meta name="theme-color" content="#222">

<script>
    (function(){
        if(''){
            if (prompt('请输入文章密码') !== ''){
                alert('密码错误！');
                history.back();
            }
        }
    })();
</script>











<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



















  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  

  

  
    
    
    <link href="https://fonts.loli.net/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=6.3.0" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.3.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=6.3.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.ico?v=6.3.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.3.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '6.3.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":true,"scrollpercent":false,"onmobile":true},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  





  <meta name="description" content="基本概念每一个file都有一个low-level name， 一般我们指inode number,  directory：存储a list of pairs  (user-readable name, low-level name)  UNIX/Linux的File System Hierarchy标准规定了文件系统目录树中各个目录的功能：  /boot - 系统启动数据 /bin - 应用程序">
<meta name="keywords" content="-review">
<meta property="og:type" content="article">
<meta property="og:title" content="文件系统">
<meta property="og:url" content="http://shelah-kuang.github.io/2019/06/21/文件系统/index.html">
<meta property="og:site_name" content="少年游">
<meta property="og:description" content="基本概念每一个file都有一个low-level name， 一般我们指inode number,  directory：存储a list of pairs  (user-readable name, low-level name)  UNIX/Linux的File System Hierarchy标准规定了文件系统目录树中各个目录的功能：  /boot - 系统启动数据 /bin - 应用程序">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://shelah-kuang.github.io/2019/06/21/文件系统/dirent.png">
<meta property="og:image" content="http://shelah-kuang.github.io/2019/06/21/文件系统/rg.png">
<meta property="og:image" content="http://shelah-kuang.github.io/2019/06/21/文件系统/nt.png">
<meta property="og:image" content="http://shelah-kuang.github.io/2019/06/21/文件系统/inode.png">
<meta property="og:updated_time" content="2019-06-22T08:54:29.100Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="文件系统">
<meta name="twitter:description" content="基本概念每一个file都有一个low-level name， 一般我们指inode number,  directory：存储a list of pairs  (user-readable name, low-level name)  UNIX/Linux的File System Hierarchy标准规定了文件系统目录树中各个目录的功能：  /boot - 系统启动数据 /bin - 应用程序">
<meta name="twitter:image" content="http://shelah-kuang.github.io/2019/06/21/文件系统/dirent.png">



  <link rel="alternate" href="/atom.xml" title="少年游" type="application/atom+xml" />




  <link rel="canonical" href="http://shelah-kuang.github.io/2019/06/21/文件系统/"/>



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>文件系统 | 少年游</title>
  









  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">少年游</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">茫茫人海，却似荒野</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">
    <a href="/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-home"></i> <br />首页</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-about">
    <a href="/about/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-user"></i> <br />关于</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">
    <a href="/tags/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />标签</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">
    <a href="/categories/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-th"></i> <br />分类</a>
  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">
    <a href="/archives/" rel="section">
      <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />归档</a>
  </li>

      
      
    </ul>
  

  

  
</nav>



  



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  
    <div class="reading-progress-bar"></div>
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://shelah-kuang.github.io/2019/06/21/文件系统/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="kuangsl">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/123.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="少年游">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">文件系统
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-06-21 21:41:14" itemprop="dateCreated datePublished" datetime="2019-06-21T21:41:14+08:00">2019-06-21</time>
            

            
              

              
                
                <span class="post-meta-divider">|</span>
                

                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">更新于</span>
                
                <time title="修改时间：2019-06-22 16:54:29" itemprop="dateModified" datetime="2019-06-22T16:54:29+08:00">2019-06-22</time>
              
            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/categories/OS/" itemprop="url" rel="index"><span itemprop="name">OS</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/06/21/文件系统/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2019/06/21/文件系统/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          
             <span id="/2019/06/21/文件系统/" class="leancloud_visitors" data-flag-title="文件系统">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数：</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><p>每一个file都有一个<code>low-level name</code>， 一般我们指<strong><code>inode number</code></strong>, </p>
<p><strong><code>directory</code></strong>：存储a list of pairs  (user-readable name, low-level name)</p>
<blockquote>
<p>UNIX/Linux的File System Hierarchy标准规定了文件系统目录树中各个目录的功能：</p>
<ul>
<li>/boot - 系统启动数据</li>
<li>/bin - 应用程序 (bash, ps, grep, …)</li>
<li>/dev - 设备文件</li>
<li>/sbin - 系统程序 (mkfs, fdisk, ifconfig, dhclient, …)</li>
<li>/etc - 配置文件 (= “etcetera”)</li>
<li>/home - 用户目录</li>
<li>/lib - 库文件 (libc.so, libpthread.so, …)</li>
<li>/media - 可移动设备 (cdrom, USB flash ,…)</li>
<li>/usr - 用户程序 (/usr/bin/, /usr/lib/, /usr/local/)</li>
<li>/var - 可变文件 (logs, snapshots, …)</li>
<li>/tmp - 临时文件</li>
</ul>
</blockquote>
<h2 id="File-System-Interface"><a href="#File-System-Interface" class="headerlink" title="File System Interface"></a>File System Interface</h2><h3 id="Creating-files"><a href="#Creating-files" class="headerlink" title="Creating files"></a>Creating files</h3><p>int fd = <strong><code>open</code></strong>(“foo”, O_CREAT|O_WRONLY|O_TRUNC, S_IRUSR|S_IWUSR);</p>
<p>O_CREAT :creates the file  if it does not exist,<br>O_WRONLY: ensures that the file can only be written to, and,<br>O_TRUNC: if the file already exists, truncates it to a size of zero bytes thus removing any existing<br>content </p>
<h3 id="Reading-And-Writing-Files"><a href="#Reading-And-Writing-Files" class="headerlink" title="Reading And Writing Files"></a>Reading And Writing Files</h3><p><strong><code>cat</code></strong> :dump the contents of the file to the screen.</p>
<p>…(还有一些 不想抄了)</p>
<h3 id="Shared-File-Table-Entries-fork-And-dup"><a href="#Shared-File-Table-Entries-fork-And-dup" class="headerlink" title="Shared File Table Entries: fork() And dup()"></a>Shared File Table Entries: fork() And dup()</h3><p>dup() call allows a process to create a new file descriptor that refers to the same underlying open file as an existing descriptor.</p>
<h3 id="Writing-Immediately-With-fsync"><a href="#Writing-Immediately-With-fsync" class="headerlink" title="Writing Immediately With fsync()"></a>Writing Immediately With fsync()</h3><p><strong><code>fsync(int fd)</code></strong>. When a process calls fsync() for a particular file descriptor, the file system responds by forcing all dirty (i.e., not yet written) data to disk, for the file referred to by the specified file descriptor.</p>
<h3 id="rename"><a href="#rename" class="headerlink" title="rename"></a>rename</h3><p><strong><code>rename(char*old, char *new),</code></strong> call is that it is (usually) implemented as an atomic call</p>
<h3 id="Getting-Information-About-Files"><a href="#Getting-Information-About-Files" class="headerlink" title="Getting Information About Files"></a>Getting Information About Files</h3><p><strong><code>stat()</code></strong> or <strong><code>fstat()</code></strong></p>
<h3 id="Reading-Directories"><a href="#Reading-Directories" class="headerlink" title="Reading Directories"></a>Reading Directories</h3><p>opendir(), readdir(), and closedir()</p>
<p>readdir()得到以下结构体：<br><img src="/2019/06/21/文件系统/dirent.png"></p>
<h3 id="Hard-Links"><a href="#Hard-Links" class="headerlink" title="Hard Links"></a>Hard Links</h3><p><strong><code>link()</code></strong> system call takes two arguments, an old pathname and a new one; when you “link” a new file name to an old one, you essentially create another way to refer to the same file. The command-line program <code>ln</code> is used to do this</p>
<p>link后的两个指向相同的inode number，对于文件系统而言，对用户可见的名字不同没有关系，因为他们指向相同的内部的结构metadata，这个是根据inode number来查找的</p>
<p>当你删除一个文件的时候，会调用unlink()，将检查对应inode number对应的reference count（link count），并将其减少1，只有其变为0的时候，才会free掉对应的数据结构</p>
<h3 id="Symbolic-Links-soft-links"><a href="#Symbolic-Links-soft-links" class="headerlink" title="Symbolic Links(soft links)"></a>Symbolic Links(soft links)</h3><p>The way a symbolic link is formed is by holding the pathname of the linked-to file as the data of the<br>link file</p>
<h3 id="Making-And-Mounting-A-File-System"><a href="#Making-And-Mounting-A-File-System" class="headerlink" title="Making And Mounting A File System"></a>Making And Mounting A File System</h3><p><strong><code>mkfs</code></strong>：give the tool, as input, a device (such as a disk partition, e.g., /dev/sda1) and a file system type (e.g., ext3), and it simply writes an empty file system, starting with a root directory, onto that disk partition.</p>
<p><strong><code>mount</code></strong>完成的工作是<strong>把一个设备和一个文件系统实现联系起来，在设备上创建一个文件系统实例，并且把创建的文件系统“放置”到文件系统中的一个路径里</strong>。</p>
<h2 id="文件系统实现"><a href="#文件系统实现" class="headerlink" title="文件系统实现"></a>文件系统实现</h2><h3 id="VSFS-Very-Simple-File-System"><a href="#VSFS-Very-Simple-File-System" class="headerlink" title="VSFS(Very Simple File System)"></a>VSFS(Very Simple File System)</h3><h4 id="Overall-Organization"><a href="#Overall-Organization" class="headerlink" title="Overall Organization"></a>Overall Organization</h4><p><img src="/2019/06/21/文件系统/rg.png"></p>
<p>我们假设以4kb为一个block，现在我们假设有一个非常小的disk，只有64个block，考虑其应该有的组成<br>a)  首先必然存储数据且应该是大部分block都存储数据<br>b）对于每一个文件，都应该有一个inode<br>c）需要有一个分配结构来追踪每一个data或者inode的block是否为free，有多种实现方式，如链表，此处采用<code>bitmap</code>的方式，每一个bit为0/1表示对应的block是否被占用，此处应有两个bitmap，data和inode各一个<br>d）一个superblock， 用于存储关于这个文件系统的信息，如有多少各inode和data blocks，inode table从哪里开始等（当挂载一个文件系统的时候，首先读superblock的信息来初始化各种参数）</p>
<h4 id="File-Organization-The-Inode"><a href="#File-Organization-The-Inode" class="headerlink" title="File Organization: The Inode"></a>File Organization: The Inode</h4><p><strong><code>Inode</code></strong>: index node</p>
<p>每一个inode都会被一个数字所指代（i-number），在操作系统中，给你这个数字，你可以直接计算出在这个磁盘中对应inode的位置</p>
<p><img src="/2019/06/21/文件系统/nt.png"></p>
<p>inode有多种存储方式，如下：</p>
<ul>
<li>连续存储在文件系统中的某个区域，这样可以直接根据inode的编号计算出inode在磁盘中的位置，这也是实现文件唯一id的一个途径；（上图采用的方式）</li>
<li>存储在文件头部，文件唯一id = 第一个数据块的编号；</li>
<li>存储在目录文件中，文件唯一id = 第一个数据块的编号，在支持链接的文件系统中，文件的元数据会有多份拷贝。</li>
</ul>
<p>在inode中，几乎存储了所有关于其对应文件的信息，我们将这些信息称为<strong><code>metadata</code></strong>,</p>
<p>包括</p>
<ul>
<li>文件的唯一id；</li>
<li>文件的类型，用于区分普通文件和目录文件；</li>
<li>访问权限，就是大家熟知的rwxrwxrwx；</li>
<li>所有者信息 (uid, gid)，但这在跨系统访问时成为很大的麻烦；</li>
<li>文件大小；</li>
<li>文件访问的时间信息：创建时间、访问时间、修改时间；</li>
<li>链接数量 (刚才已经提到)；</li>
<li>一些其他信息，例如文件的第一个数据块的编号等</li>
</ul>
<p>一种inode存储的信息示例如下：</p>
<p><img src="/2019/06/21/文件系统/inode.png" height="75%" width="75%"></p>
<p>在inode中有一个重要信息是指向文件data所在block的地址的指针，一种实现方式是采用<strong><code>direct pointer</code></strong>，但是这样对于较大的文件，存储在多个不同的block中时会比较麻烦，此时一种方式时采用<strong><code>indirect pointer</code></strong>,这个指针指向一个全部存储对应的direct pointer的block，而如果还要更大的话，则可以采用<strong><code>double indirect pointer</code></strong>(即指向一个全是indirect pointer的block)，如果还要更多，可以以此类推<strong><code>triple indirect pointer</code></strong></p>
<h4 id="Directory-Organization"><a href="#Directory-Organization" class="headerlink" title="Directory Organization"></a>Directory Organization</h4><p>each entry has an inode number, record length (the total bytes for the name plus any left over space), string length (the actual length of the name), and finally the name of the entry.</p>
<p>目录同样被操作系统认为是一个文件，有对应的inode，只是inode中其类型为directory</p>
<h4 id="Free-Space-Management"><a href="#Free-Space-Management" class="headerlink" title="Free Space Management"></a>Free Space Management</h4><p>在vsfs中，用的是bitmap，还可以用链表来实现，现代操作系统中有更多的实现方式如b-tree</p>
<h4 id="Access-Paths-Reading-and-Writing"><a href="#Access-Paths-Reading-and-Writing" class="headerlink" title="Access Paths: Reading and Writing"></a>Access Paths: Reading and Writing</h4><p>对于一个路径，如果我们想找到对应的文件或目录的inode值，其值一般会存储在其父目录中，而<strong>/</strong>没有父目录，故而一般在unix系统中设置其inode值为2，找到父目录的inode之后，就根据指针找到其data区域，在data中找到其对应文件的入口，找到后，文件系统就获取的该文件的inode number，之后类似的重复直到找到对应文件为止。在open（）操作中，找到文件后，会把文件的inode读入，并在pre-process open-file table中分配一个fd给这个process。</p>
<p>打开文件后如执行read操作，则会更新inode中的存储的时间变量，然后回更新fd对应的in-memory open file table，修改文件偏移量</p>
<p>如果要写文件的话，要先读inode，再读bitmap，再写bitmap，分配后再写data，写完后更新inode</p>
<h3 id="FAT与ext2"><a href="#FAT与ext2" class="headerlink" title="FAT与ext2"></a>FAT与ext2</h3><p>断章了，见下一篇blog</p>

      
    </div>

    

    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>kuangsl</li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://shelah-kuang.github.io/2019/06/21/文件系统/" title="文件系统">http://shelah-kuang.github.io/2019/06/21/文件系统/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明出处！</li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/review/" rel="tag"># -review</a>
          
        </div>
      

      
      
        <div class="post-widgets">
        
          <div class="wp_rating">
            <div id="wpac-rating"></div>
          </div>
        

        

        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/06/21/IO设备与驱动/" rel="next" title="IO设备与驱动">
                <i class="fa fa-chevron-left"></i> IO设备与驱动
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/06/21/FAT与ext2/" rel="prev" title="FAT与ext2">
                FAT与ext2 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>
  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
      <div id="sidebar-dimmer"></div>
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/123.jpg"
                alt="kuangsl" />
            
              <p class="site-author-name" itemprop="name">kuangsl</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">37</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">5</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">9</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  <a href="https://github.com/shelah-kuang" target="_blank" title="GitHub"><i class="fa fa-fw fa-github"></i>GitHub</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="mailto:923950043@qq.com" target="_blank" title="E-Mail"><i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  
                </span>
              
                <span class="links-of-author-item">
                  <a href="https://twitter.com/Kshulei" target="_blank" title="Twitter"><i class="fa fa-fw fa-twitter"></i>Twitter</a>
                  
                </span>
              
            </div>
          

          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://mengzelev.github.io/" title="mengzelev" target="_blank">mengzelev</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://marukohe.github.io" title="hw" target="_blank">hw</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://michael1015198808.github.io/" title="鄢振宇" target="_blank">鄢振宇</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://doowzs.com/" title="TianYun Zhang" target="_blank">TianYun Zhang</a>
                  </li>
                
              </ul>
            </div>
          

          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#基本概念"><span class="nav-number">1.</span> <span class="nav-text">基本概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#File-System-Interface"><span class="nav-number">2.</span> <span class="nav-text">File System Interface</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Creating-files"><span class="nav-number">2.1.</span> <span class="nav-text">Creating files</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Reading-And-Writing-Files"><span class="nav-number">2.2.</span> <span class="nav-text">Reading And Writing Files</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Shared-File-Table-Entries-fork-And-dup"><span class="nav-number">2.3.</span> <span class="nav-text">Shared File Table Entries: fork() And dup()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Writing-Immediately-With-fsync"><span class="nav-number">2.4.</span> <span class="nav-text">Writing Immediately With fsync()</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#rename"><span class="nav-number">2.5.</span> <span class="nav-text">rename</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Getting-Information-About-Files"><span class="nav-number">2.6.</span> <span class="nav-text">Getting Information About Files</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Reading-Directories"><span class="nav-number">2.7.</span> <span class="nav-text">Reading Directories</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hard-Links"><span class="nav-number">2.8.</span> <span class="nav-text">Hard Links</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Symbolic-Links-soft-links"><span class="nav-number">2.9.</span> <span class="nav-text">Symbolic Links(soft links)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Making-And-Mounting-A-File-System"><span class="nav-number">2.10.</span> <span class="nav-text">Making And Mounting A File System</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#文件系统实现"><span class="nav-number">3.</span> <span class="nav-text">文件系统实现</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#VSFS-Very-Simple-File-System"><span class="nav-number">3.1.</span> <span class="nav-text">VSFS(Very Simple File System)</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Overall-Organization"><span class="nav-number">3.1.1.</span> <span class="nav-text">Overall Organization</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#File-Organization-The-Inode"><span class="nav-number">3.1.2.</span> <span class="nav-text">File Organization: The Inode</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Directory-Organization"><span class="nav-number">3.1.3.</span> <span class="nav-text">Directory Organization</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Free-Space-Management"><span class="nav-number">3.1.4.</span> <span class="nav-text">Free Space Management</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Access-Paths-Reading-and-Writing"><span class="nav-number">3.1.5.</span> <span class="nav-text">Access Paths: Reading and Writing</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#FAT与ext2"><span class="nav-number">3.2.</span> <span class="nav-text">FAT与ext2</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      
        <div class="back-to-top">
          <i class="fa fa-arrow-up"></i>
          
        </div>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">kuangsl</span>

  

  
</div>




  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动 v3.7.1</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://theme-next.org">NexT.Gemini</a> v6.3.0</div>



<div class="theme-info">
  <div class="powered-by"></div>
  <span class="post-count">博客全站共29.1k字</span>
</div>
        








        
      </div>
    </footer>

    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  



  
  



  
  



  
  





  



  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="true"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three-waves.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/canvas_lines.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/canvas_sphere.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/reading_progress/reading_progress.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.3.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.3.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.3.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.3.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.3.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.3.0"></script>



  



  








  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  
  
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(function (item) {
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: false,
        notify: false,
        appId: 'gSk22pMIh7c4Gg3lGJ12IajV-gzGzoHsz',
        appKey: '5zTJR4tUyEGtkoitJt0OWfvy',
        placeholder: '发起进攻(　 ´-ω ･)▄︻┻┳══━一',
        avatar:'mm',
        meta:guest,
        pageSize:'10' || 10,
        visitor: true
    });
  </script>



  





  

  

  

  
  

  
  

  
    
      <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
        processEscapes: true,
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      },
      TeX: {equationNumbers: { autoNumber: "AMS" }}
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>
<script type="text/javascript" src="//cdn.jsdelivr.net/npm/mathjax@2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

    
  


  
  
  <script type="text/javascript">
  wpac_init = window.wpac_init || [];
  wpac_init.push({widget: 'Rating', id: 16076,
    el: 'wpac-rating',
    color: 'f79533'
  });
  (function() {
    if ('WIDGETPACK_LOADED' in window) return;
    WIDGETPACK_LOADED = true;
    var mc = document.createElement('script');
    mc.type = 'text/javascript';
    mc.async = true;
    mc.src = '//embed.widgetpack.com/widget.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(mc, s.nextSibling);
  })();
  </script>


  

  

  

  
  
  
  <script src="/lib/bookmark/bookmark.min.js?v=1.0"></script>
  <script type="text/javascript">
  
    bookmark.scrollToMark('auto', "#更多");
  
  </script>


  

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-backstretch/2.0.4/jquery.backstretch.min.js"></script>
  <script>
  $("body").backstretch("https://pic3.zhimg.com/80/v2-78dfe120c4f516da57a7c3a5c094789a_hd.jpg");
  </script>
</body>
</html>
<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>